<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Assessment</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Slab:wght@300;400;500;700&family=Roboto+Serif&family=Sedan+SC&family=Rokkitt:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body class="overflow-hidden font-roboto">
    <div class="flex min-h-screen h-screen overflow-hidden">
      <aside
        class="w-64 text-black p-6 bg-[linear-gradient(to_bottom,#FFF1C5_10%,#f6c7d8_50%,#D9B4F7_100%)]"
      >
        <nav class="space-y-8 m-4 text-lg">
          <button
            onclick="window.location.href='home.html'"
            class="w-full py-3 rounded flex justify-center items-center gap-3 hover:text-white hover:bg-black font-[roboto_condensed]"
          >
            <i class="fa-solid fa-house"></i>
            Home
          </button>
          <button
            onclick="window.location.href='Management.html'"
            class="w-full py-3 rounded flex justify-center items-center gap-3 hover:text-white hover:bg-black font-[roboto_condensed]"
          >
            <i class="fa-solid fa-list-check"></i>
            Management
          </button>
          <button
            onclick="window.location.href='Evaluation.html'"
            class="w-full py-3 rounded flex justify-center items-center gap-3 hover:text-white hover:bg-black font-[roboto_condensed]"
          >
            <i class="fa-solid fa-pen-to-square"></i>
            Evaluation
          </button>
          <button
            onclick="window.location.href='Overview.html'"
            class="w-full py-3 rounded flex justify-center items-center gap-3 hover:text-white hover:bg-black font-[roboto_condensed]"
          >
            <i class="fa-solid fa-chart-simple"></i>
            Overview
          </button>
          <button
            onclick="window.location.href='InstructorProfile.html'"
            class="w-full py-3 rounded flex justify-center items-center gap-3 hover:text-white hover:bg-black font-[roboto_condensed]"
          >
            <i class="fa-solid fa-user"></i>
            Profile
          </button>
          <button
            onclick="location.reload()"
            class="w-full py-3 rounded flex justify-center items-center gap-3 hover:text-white hover:bg-black font-[roboto_condensed] bg-black/20"
          >
            <i class="fa-solid fa-circle-plus"></i>
            Build Assessment
          </button>
          <button
            onclick="window.location.href='../index.html'"
            class="w-full py-3 rounded flex justify-center items-center gap-3 hover:text-white hover:bg-black font-[roboto_condensed]"
          >
            <i class="fa-solid fa-right-from-bracket"></i>
            Logout
          </button>
        </nav>
      </aside>
      <div class="flex-1 flex flex-col overflow-hidden">
        <header
          class="w-full flex justify-between items-center px-8 py-4 shadow text-black"
          style="background: #fff1c5"
        >
          <a href="#" class="text-xl text-black font-sedan_sc"
            >Unified Assessment Platform</a
          >
          <div class="flex items-center space-x-12 text-2xl">
            <div class="relative cursor-pointer">
              <a href="Notifications.html"
                ><i class="fa-regular fa-bell text-black text-2xl"></i
              ></a>
              <span
                id="notifyCount"
                class="absolute -top-1 -right-3 bg-red-600 text-white text-xs w-4 h-4 flex items-center justify-center rounded-full font-bold hidden"
              ></span>
            </div>
            <a href="InstructorProfile.html"
              ><i class="fa-solid fa-user text-black cursor-pointer"></i
            ></a>
          </div>
        </header>
        <div class="p-10 overflow-y-auto h-full">
          <h2 class="text-2xl text-[#AC7F5E] mb-6 font-roboto_slab">
            Create Assessment Page
          </h2>
          <div
            class="bg-white border border-[#AC7F5E] shadow-lg p-6 rounded-xl space-y-6"
          >
            <h3 class="text-xl font-[Rokkitt] mb-4 font-bold text-[#AC7F5E]">
              Assessment Details
            </h3>
            <div class="grid grid-cols-2 gap-6">
              <div class="space-y-2">
                <label for="title" class="font-roboto_serif font-semibold"
                  >Title</label
                >
                <input
                  type="text"
                  id="title"
                  placeholder="E.g., CSS Fundamentals"
                  class="w-full border border-gray-300 p-2 rounded focus:border-[#00C3D0] outline-none transition"
                />
              </div>
              <div class="space-y-2">
                <label for="duration" class="font-roboto_serif font-semibold"
                  >Duration (Mins)</label
                >
                <input
                  type="number"
                  id="duration"
                  placeholder="E.g., 60"
                  class="w-full border border-gray-300 p-2 rounded focus:border-[#00C3D0] outline-none transition"
                />
              </div>
            </div>
            <div class="space-y-2">
              <label for="description" class="font-roboto_serif font-semibold"
                >Description</label
              >
              <textarea
                id="description"
                rows="3"
                placeholder="Brief description of the assessment..."
                class="w-full border border-gray-300 p-2 rounded focus:border-[#00C3D0] outline-none transition"
              ></textarea>
            </div>
            <div class="grid grid-cols-3 gap-6">
              <div class="space-y-2">
                <label for="subject" class="font-roboto_serif font-semibold"
                  >Subject</label
                >
                <select
                  id="subject"
                  class="w-full border border-gray-300 p-2 rounded cursor-pointer focus:border-[#00C3D0] outline-none transition"
                >
                  <option>HTML</option>
                  <option>CSS</option>
                  <option>JavaScript</option>
                </select>
              </div>
              <div class="space-y-2">
                <label for="level" class="font-roboto_serif font-semibold"
                  >Level</label
                >
                <select
                  id="level"
                  class="w-full border border-gray-300 p-2 rounded cursor-pointer focus:border-[#00C3D0] outline-none transition"
                >
                  <option>Beginner</option>
                  <option>Intermediate</option>
                  <option>Advanced</option>
                </select>
              </div>
              <div class="space-y-2">
                <label for="passMark" class="font-roboto_serif font-semibold"
                  >Passing Mark (%)</label
                >
                <input
                  type="number"
                  id="passMark"
                  placeholder="E.g., 70"
                  class="w-full border border-gray-300 p-2 rounded focus:border-[#00C3D0] outline-none transition"
                />
              </div>
            </div>
            <h3
              class="text-xl font-[Rokkitt] pt-6 mb-4 font-bold text-[#AC7F5E]"
            >
              Assessment Questions
            </h3>
            <div class="space-y-4">
              <div class="flex items-center gap-4">
                <button
                  id="addMcqBtn"
                  class="bg-[#D9B4F7] hover:bg-[#C296F5] px-4 py-2 rounded text-sm transition"
                >
                  Add MCQ
                </button>
                <button
                  id="addShortBtn"
                  class="bg-[#F6C7D8] hover:bg-[#F3A9C3] px-4 py-2 rounded text-sm transition"
                >
                  Add Short Answer
                </button>
                <button
                  id="addLongBtn"
                  class="bg-[#FFF1C5] hover:bg-[#FDE0A0] px-4 py-2 rounded text-sm transition"
                >
                  Add Long Answer
                </button>
              </div>
              <div id="questionsContainer" class="space-y-4"></div>
              <div
                id="placeholder"
                class="border border-dashed border-gray-400 p-6 rounded-lg text-center cursor-pointer hover:bg-gray-100"
              >
                <p class="text-gray-500">
                  Click a button above to add a new question.
                </p>
              </div>
            </div>
            <div class="pt-6 flex justify-end gap-4">
              <button
                id="saveDraftBtn"
                class="border border-gray-400 text-gray-700 hover:bg-gray-100 py-2 px-6 rounded transition"
              >
                Save Draft
              </button>
              <button
                id="publishBtn"
                class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded transition"
              >
                Publish Assessment
              </button>
            </div>
          </div>
        </div>
        <footer
          class="w-full py-4 text-center bg-white shadow-inner text-gray-600 text-sm"
        >
          Â© 2025 Unified Assessment Platform. All rights reserved. <br />
          Empower Learning. Enhance Assessment.
        </footer>
      </div>
    </div>
    <script>
      const badge = document.getElementById("notifyCount");
      const count = 3;
      if (count > 0) {
        badge.innerText = count;
        badge.classList.remove("hidden");
      }
      const addMcqBtn = document.getElementById("addMcqBtn");
      const addShortBtn = document.getElementById("addShortBtn");
      const addLongBtn = document.getElementById("addLongBtn");
      const questionsContainer = document.getElementById("questionsContainer");
      const placeholder = document.getElementById("placeholder");
      const saveDraftBtn = document.getElementById("saveDraftBtn");
      const publishBtn = document.getElementById("publishBtn");
      let questions = [];
      let editAssessmentIndex = localStorage.getItem("editIndex");
      function formatDate(d) {
        const dt = new Date(d);
        const day = String(dt.getDate()).padStart(2, "0");
        const monthNames = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec",
        ];
        const month = monthNames[dt.getMonth()];
        const year = dt.getFullYear();
        return `${day} ${month} ${year}`;
      }
      function renderQuestions() {
        questionsContainer.innerHTML = "";
        if (questions.length === 0) {
          placeholder.classList.remove("hidden");
        } else {
          placeholder.classList.add("hidden");
        }
        questions.forEach((q, idx) => {
          const wrapper = document.createElement("div");
          wrapper.className =
            "border border-[#00C3D0] p-4 rounded-lg bg-gray-50";
          const top = document.createElement("div");
          top.className = "flex justify-between items-center";
          const title = document.createElement("p");
          title.className = "font-bold";
          title.innerText = `${q.type.toUpperCase()} (${q.marks || 0} Marks)`;
          const actions = document.createElement("div");
          actions.className = "flex gap-2";
          const editBtn = document.createElement("button");
          editBtn.className = "text-blue-500 hover:text-blue-700";
          editBtn.innerText = "Edit";
          const deleteBtn = document.createElement("button");
          deleteBtn.className = "text-red-500 hover:text-red-700";
          deleteBtn.innerText = "Delete";
          actions.appendChild(editBtn);
          actions.appendChild(deleteBtn);
          top.appendChild(title);
          top.appendChild(actions);
          wrapper.appendChild(top);
          const content = document.createElement("div");
          content.className = "mt-2";
          if (!q.editMode) {
            const qText = document.createElement("p");
            qText.className = "text-sm";
            qText.innerText = `Q: ${q.question}`;
            content.appendChild(qText);
            if (q.type === "mcq") {
              q.options.forEach((opt, i) => {
                const p = document.createElement("p");
                p.className = "text-xs text-gray-600 space-y-1";
                const correctMark = q.correct === i ? " (Correct)" : "";
                p.innerText = `${String.fromCharCode(
                  65 + i
                )}) ${opt}${correctMark}`;
                content.appendChild(p);
              });
            } else {
              const p = document.createElement("p");
              p.className = "text-xs text-gray-600";
              p.innerText =
                q.type === "short"
                  ? "Short answer expected."
                  : "Long answer expected.";
              content.appendChild(p);
            }
          } else {
            const qLabel = document.createElement("label");
            qLabel.className = "block text-sm font-medium";
            qLabel.innerText = "Question";
            const qInput = document.createElement("textarea");
            qInput.className = "w-full border p-2 rounded mt-1";
            qInput.rows = 2;
            qInput.value = q.question;
            wrapper.appendChild(qLabel);
            wrapper.appendChild(qInput);
            if (q.type === "mcq") {
              const optsWrapper = document.createElement("div");
              optsWrapper.className = "mt-2 grid grid-cols-1 gap-2";
              q.options.forEach((opt, i) => {
                const row = document.createElement("div");
                row.className = "flex items-center gap-2";
                const radio = document.createElement("input");
                radio.type = "radio";
                radio.name = `correct-${idx}`;
                radio.checked = q.correct === i;
                const optInput = document.createElement("input");
                optInput.type = "text";
                optInput.className = "w-full border p-2 rounded";
                optInput.value = opt;
                row.appendChild(radio);
                row.appendChild(optInput);
                optsWrapper.appendChild(row);
              });
              wrapper.appendChild(optsWrapper);
            } else {
              const note = document.createElement("p");
              note.className = "text-xs text-gray-600 mt-2";
              note.innerText =
                q.type === "short" ? "Short answer field" : "Long answer field";
              wrapper.appendChild(note);
            }
            const marksLabel = document.createElement("label");
            marksLabel.className = "block text-sm font-medium mt-2";
            marksLabel.innerText = "Marks";
            const marksInput = document.createElement("input");
            marksInput.type = "number";
            marksInput.className = "w-32 border p-2 rounded mt-1";
            marksInput.value = q.marks || 0;
            wrapper.appendChild(marksLabel);
            wrapper.appendChild(marksInput);
            const editActions = document.createElement("div");
            editActions.className = "mt-3 flex gap-2";
            const saveBtn = document.createElement("button");
            saveBtn.className = "px-3 py-1 bg-green-500 text-white rounded";
            saveBtn.innerText = "Save";
            const cancelBtn = document.createElement("button");
            cancelBtn.className = "px-3 py-1 border rounded";
            cancelBtn.innerText = "Cancel";
            editActions.appendChild(saveBtn);
            editActions.appendChild(cancelBtn);
            wrapper.appendChild(editActions);
            saveBtn.addEventListener("click", () => {
              const newQuestion = qInput.value.trim();
              if (newQuestion === "") {
                alert("Question cannot be empty");
                return;
              }
              q.question = newQuestion;
              q.marks = Number(marksInput.value) || 0;
              if (q.type === "mcq") {
                const optInputs =
                  wrapper.querySelectorAll("input[type='text']");
                q.options = Array.from(optInputs).map((i) => i.value || "");
                const radios = wrapper.querySelectorAll(
                  `input[type='radio'][name='correct-${idx}']`
                );
                radios.forEach((r, ri) => {
                  if (r.checked) q.correct = ri;
                });
              }
              q.editMode = false;
              renderQuestions();
            });
            cancelBtn.addEventListener("click", () => {
              q.editMode = false;
              renderQuestions();
            });
          }
          wrapper.appendChild(content);
          editBtn.addEventListener("click", () => {
            q.editMode = true;
            renderQuestions();
          });
          deleteBtn.addEventListener("click", () => {
            if (confirm("Are you sure you want to delete this question?")) {
              questions.splice(idx, 1);
              renderQuestions();
            }
          });
          questionsContainer.appendChild(wrapper);
        });
      }
      function createMcq() {
        const q = {
          id: Date.now() + Math.random(),
          type: "mcq",
          question: "New MCQ question",
          options: ["Option A", "Option B", "Option C", "Option D"],
          correct: 0,
          marks: 1,
          editMode: true,
        };
        questions.push(q);
        renderQuestions();
      }
      function createShort() {
        const q = {
          id: Date.now() + Math.random(),
          type: "short",
          question: "New short answer question",
          marks: 2,
          editMode: true,
        };
        questions.push(q);
        renderQuestions();
      }
      function createLong() {
        const q = {
          id: Date.now() + Math.random(),
          type: "long",
          question: "New long answer question",
          marks: 5,
          editMode: true,
        };
        questions.push(q);
        renderQuestions();
      }
      addMcqBtn.addEventListener("click", () => {
        createMcq();
      });
      addShortBtn.addEventListener("click", () => {
        createShort();
      });
      addLongBtn.addEventListener("click", () => {
        createLong();
      });
      function loadForEdit() {
        const stored = JSON.parse(localStorage.getItem("assessments") || "[]");
        if (editAssessmentIndex !== null) {
          const idx = Number(editAssessmentIndex);
          if (stored[idx]) {
            const a = stored[idx];
            document.getElementById("title").value = a.title || "";
            document.getElementById("duration").value = a.duration || "";
            document.getElementById("description").value = a.description || "";
            document.getElementById("subject").value = a.subject || "HTML";
            document.getElementById("level").value = a.level || "Beginner";
            document.getElementById("passMark").value = a.passMark || "";
            questions = a.questions.map((q) => ({ ...q, editMode: false }));
            renderQuestions();
          }
          localStorage.removeItem("editIndex");
          editAssessmentIndex = null;
        }
      }
      function assembleAssessment(status) {
        const title = document.getElementById("title").value.trim();
        if (title === "") {
          alert("Please enter a title");
          return null;
        }
        const duration =
          Number(document.getElementById("duration").value) || "";
        const description = document.getElementById("description").value || "";
        const subject = document.getElementById("subject").value;
        const level = document.getElementById("level").value;
        const passMark =
          Number(document.getElementById("passMark").value) || "";
        const createdOn = formatDate(new Date());
        const deadlineDate = new Date();
        deadlineDate.setDate(deadlineDate.getDate() + 7);
        const deadline = formatDate(deadlineDate);
        const types = Array.from(new Set(questions.map((q) => q.type)))
          .map((t) => (t === "mcq" ? "MCQ" : t === "short" ? "Short" : "Long"))
          .join(",");
        const assessment = {
          title,
          duration,
          description,
          subject,
          level,
          passMark,
          createdOn,
          deadline,
          type: types || "MCQ",
          status,
          questions,
        };
        return assessment;
      }
      function saveToLocal(assessment, replaceIndex) {
        const stored = JSON.parse(localStorage.getItem("assessments") || "[]");
        if (replaceIndex !== undefined && replaceIndex !== null) {
          stored[replaceIndex] = assessment;
        } else {
          stored.push(assessment);
        }
        localStorage.setItem("assessments", JSON.stringify(stored));
      }
      saveDraftBtn.addEventListener("click", () => {
        const existingIndex = localStorage.getItem("currentEditReplaceIndex");
        const assessment = assembleAssessment("Draft");
        if (!assessment) return;
        if (existingIndex !== null) {
          const idx = Number(existingIndex);
          saveToLocal(assessment, idx);
          localStorage.removeItem("currentEditReplaceIndex");
        } else {
          saveToLocal(assessment);
        }
        window.location.href = "Management.html";
      });
      publishBtn.addEventListener("click", () => {
        const existingIndex = localStorage.getItem("currentEditReplaceIndex");
        const assessment = assembleAssessment("Active");
        if (!assessment) return;
        if (existingIndex !== null) {
          const idx = Number(existingIndex);
          saveToLocal(assessment, idx);
          localStorage.removeItem("currentEditReplaceIndex");
        } else {
          saveToLocal(assessment);
        }
        window.location.href = "Management.html";
      });
      function checkIncomingEdit() {
        const replaceIndex = localStorage.getItem("replaceIndex");
        if (replaceIndex !== null) {
          localStorage.setItem("currentEditReplaceIndex", replaceIndex);
          localStorage.removeItem("replaceIndex");
          const stored = JSON.parse(
            localStorage.getItem("assessments") || "[]"
          );
          const a = stored[Number(replaceIndex)];
          if (a) {
            document.getElementById("title").value = a.title || "";
            document.getElementById("duration").value = a.duration || "";
            document.getElementById("description").value = a.description || "";
            document.getElementById("subject").value = a.subject || "HTML";
            document.getElementById("level").value = a.level || "Beginner";
            document.getElementById("passMark").value = a.passMark || "";
            questions = a.questions.map((q) => ({ ...q, editMode: false }));
            renderQuestions();
          }
        }
      }
      window.addEventListener("load", () => {
        loadForEdit();
        checkIncomingEdit();
        renderQuestions();
        const badge = document.getElementById("notifyCount");
        const notificationCount = 3;
        if (notificationCount > 0) {
          badge.innerText = notificationCount;
          badge.classList.remove("hidden");
        }
      });
    </script>
  </body>
</html>
